<form [formGroup]="form" class="ev-horizontal-container">
  <div class="boxTripleSize">
    <table class="cadre_primary">
      <tr>
        <td [class]="'cadre_header_' + ((getSumPoids()>form.get('Poids').value || getSumPoids()===0) ? 'warn' : 'primary')">
          <table class="table-no-pad-no-space">
            <tr style="vertical-align:middle;">
              <td>
                <mat-icon class="ev-button-left color-tooltip-info-icon" [matTooltip]="getCreationModificationTooltipText()">info</mat-icon>
              </td>
              <td style="width:100%;">
                {{applicationUserContext.getCulturedRessourceText(52)}}
                &nbsp;-&nbsp;{{applicationUserContext.getCulturedRessourceText(786) + " = " + getSumPoids().toFixed(3)}}
                &nbsp;-&nbsp;<span class="color-accent">{{applicationUserContext.getCulturedRessourceText(242) + " = " + getSumPoidsCalculLimiteConformite().toFixed(3)}}</span>
                &nbsp;-&nbsp;<span class="color-accent">{{applicationUserContext.getCulturedRessourceText(243) + " = " + getSumPercentage().toFixed(2) + "%"}}</span>
                <ng-container *ngIf="getSumPoids()>form.get('Poids').value">&nbsp;-&nbsp;{{applicationUserContext.getCulturedRessourceText(783)}}</ng-container>
                <ng-container *ngIf="getSumPoids()===0">&nbsp;-&nbsp;{{applicationUserContext.getCulturedRessourceText(783)}}</ng-container>
              </td>
              <td>
                <button mat-icon-button class="ev-button-left" type="button" (click)="onDelete();" *ngIf="!locked">
                  <mat-icon aria-label="Delete">delete</mat-icon>
                </button>
              </td>
            </tr>
          </table>
        </td>
      </tr>
      <tr>
        <td class="cadre_body">
          <table class="table-no-pad-no-space">
            <tr style="vertical-align:top;">
              <td>
                <mat-form-field class="ev-date-picker" style="width:100%;">
                  <mat-label>{{applicationUserContext.getCulturedRessourceText(22)}}</mat-label>
                  <input matInput [matDatepicker]="pickerDControle" formControlName="DControle" required [errorStateMatcher]="matcher">
                  <mat-datepicker-toggle matIconPrefix [for]="pickerDControle"></mat-datepicker-toggle>
                  <mat-datepicker #pickerDControle></mat-datepicker>
                  <button *ngIf="form.get('DControle').value && form.get('DControle').enabled" matIconSuffix mat-icon-button aria-label="Supprimer" tabindex="-1" type="button" (click)="form.get('DControle').setValue(null);">
                    <mat-icon>close</mat-icon>
                  </button>
                  <mat-error align="end" *ngIf="form.get('DControle').errors?.required">{{applicationUserContext.getCulturedRessourceText(293)}}</mat-error>
                </mat-form-field>
                <mat-form-field style="width:100%;">
                  <mat-label>{{applicationUserContext.getCulturedRessourceText(20)}}</mat-label>
                  <mat-select formControlName="ControleControleurList" required [errorStateMatcher]="matcher">
                    <mat-option *ngFor="let contactAdresse of controleControleurList" [value]="contactAdresse.RefContactAdresse">{{contactAdresse.ListText}}</mat-option>
                  </mat-select>
                  <button *ngIf="form.get('ControleControleurList').value && form.get('ControleControleurList').enabled" matIconSuffix mat-icon-button aria-label="Supprimer" (click)="$event.stopPropagation(); form.get('ControleControleurList').setValue(null)" tabindex="-1" type="button">
                    <mat-icon>close</mat-icon>
                  </button>
                  <button *ngIf="form.get('ControleControleurList').value" matIconSuffix mat-icon-button aria-label="Details" (click)="$event.stopPropagation(); showDetails('ControleControleur', form.get('ControleControleurList').value); " tabindex="-1" type="button">
                    <mat-icon>details</mat-icon>
                  </button>
                  <mat-error align="end" *ngIf="(form.get('ControleControleurList').touched || form.get('ControleControleurList').dirty) && form.get('ControleControleurList').errors?.required">{{applicationUserContext.getCulturedRessourceText(293)}}</mat-error>
                </mat-form-field>
                <mat-form-field style="width:100%;">
                  <mat-label>{{applicationUserContext.getCulturedRessourceText(785)}}</mat-label>
                  <input matInput formControlName="Poids" mask="separator.2" required [errorStateMatcher]="matcher" />
                  <button *ngIf="form.get('Poids').value!=null && form.get('Poids').enabled" matIconSuffix mat-icon-button aria-label="Supprimer" (click)="form.get('Poids').setValue(null)" tabindex="-1" type="button">
                    <mat-icon>close</mat-icon>
                  </button>
                  <mat-error align="end" *ngIf="form.get('Poids').errors?.required">{{applicationUserContext.getCulturedRessourceText(293)}}</mat-error>
                  <mat-error align="end" *ngIf="form.get('Poids').errors?.max">
                    {{applicationUserContext.getCulturedRessourceText(573) + (form.get('Poids').errors?.max?.max?.toString() | number:'':applicationUserContext.currentCultureName)}}
                  </mat-error>
                </mat-form-field>
                <mat-form-field style="width:100%;">
                  <mat-label>{{applicationUserContext.getCulturedRessourceText(104)}}</mat-label>
                  <textarea matInput formControlName="Cmt" style="height:300px;"></textarea>
                  <button *ngIf="form.get('Cmt').value && form.get('Cmt').enabled" matIconSuffix mat-icon-button aria-label="Supprimer" (click)="form.get('Cmt').setValue(null)" tabindex="-1" type="button">
                    <mat-icon>close</mat-icon>
                  </button>
                </mat-form-field>
              </td>
              <td style="width:20px;"></td>
              <td>
                <table class="fixed_headers_controle_description_controles table-no-pad-no-space">
                  <tbody formArrayName="ControleDescriptionControles">
                    <tr [formGroupName]="i" *ngFor="let group of getFormData.controls; let i=index">
                      <td style="padding: 5px 5px 0px 5px; text-align:right;">
                        {{controle.ControleDescriptionControles[i].LibelleCultured}}
                      </td>
                      <td style="padding: 5px 5px 0px 5px;">
                        <mat-form-field style="width:100%;">
                          <mat-label>{{applicationUserContext.getCulturedRessourceText(56)}}</mat-label>
                          <input matInput formControlName="Poids" mask="separator.3" [errorStateMatcher]="matcher"
                                 [class]="controle.ControleDescriptionControles[i].CalculLimiteConformite ? 'color-accent-dark' : ''" />
                          <button *ngIf="group.get('Poids').value!=null && group.get('Poids').enabled" matIconSuffix mat-icon-button aria-label="Supprimer" (click)="group.get('Poids').setValue(null)" tabindex="-1" type="button">
                            <mat-icon>close</mat-icon>
                          </button>
                        </mat-form-field>
                      </td>
                      <td [class]="controle.ControleDescriptionControles[i].CalculLimiteConformite ? 'color-accent-dark' : ''">
                        {{(group.get('Poids').value && group.get('Poids').value) ? toFixed(((group.get("Poids").value / form.get('Poids').value)*100), 2) : 0}}&nbsp;&#37;
                      </td>
                    </tr>
                  </tbody>
                </table>
              </td>
            </tr>
          </table>
        </td>
      </tr>
    </table>
  </div>
</form>
